"use strict";(()=>{var e={};e.id=520,e.ids=[520],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8585:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>g,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>_,staticGenerationAsyncStorage:()=>c});var a={};s.r(a),s.d(a,{POST:()=>u});var i=s(9303),r=s(8716),n=s(670),o=s(7070),l=s(7857);async function p(){console.log("\uD83C\uDF31 Starting seed process...");let e="https://placeholder-url.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)return console.error("âŒ Missing Supabase environment variables"),{success:!1,message:"Missing Supabase environment variables"};let s=(0,l.eI)(e,t,{auth:{autoRefreshToken:!1,persistSession:!1}});try{let e;let{data:t}=await s.from("companies").select("id").limit(1);if(t&&t.length>0)e=t[0].id,console.log(`ðŸ¢ Using existing company: ${e}`);else{console.log("\uD83C\uDFE2 Creating new Demo Company...");let{data:t,error:a}=await s.from("companies").insert({name:"Malta Tech Solutions Ltd",registration_number:"C12345",email:"hr@maltatech.com",subscription_tier:"professional"}).select().single();if(a)throw Error(`Failed to create company: ${a.message}`);e=t.id}let a=new Date,i=e=>e.toISOString().split("T")[0],r=e=>{let t=new Date(a);return t.setDate(t.getDate()+e),i(t)},n=[{first_name:"Maria",last_name:"Santos",nationality:"Philippines",passport_number:"P8291032A",position:"Senior Nurse",department:"Healthcare",status:"active",visa:{visa_type:"Single Permit",issue_date:r(-200),expiry_date:r(165),status:"valid"}},{first_name:"Rahul",last_name:"Sharma",nationality:"India",passport_number:"Z1234567",position:"Backend Developer",department:"Engineering",status:"active",visa:{visa_type:"Key Employee",issue_date:r(-300),expiry_date:r(45),status:"valid"}},{first_name:"Sofia",last_name:"Petrova",nationality:"Russia",passport_number:"750281923",position:"Marketing Specialist",department:"Marketing",status:"active",visa:{visa_type:"Specialist Employee",issue_date:r(-350),expiry_date:r(10),status:"valid"}},{first_name:"Arjun",last_name:"Singh",nationality:"Nepal",passport_number:"N0987654",position:"Construction Supervisor",department:"Operations",status:"active",visa:{visa_type:"Single Permit",issue_date:r(-400),expiry_date:r(-5),status:"expired"}},{first_name:"Hassan",last_name:"Ali",nationality:"Pakistan",passport_number:"PK998877",position:"Delivery Coordinator",department:"Logistics",status:"active",visa:{visa_type:"Single Permit",issue_date:r(-30),expiry_date:r(330),status:"valid"}}];for(let t of(console.log("\uD83D\uDC65 Seeding 5 employees..."),n)){let{data:a,error:i}=await s.from("employees").insert({company_id:e,first_name:t.first_name,last_name:t.last_name,nationality:t.nationality,passport_number:t.passport_number,position:t.position,department:t.department,status:t.status,email:`${t.first_name.toLowerCase()}.${t.last_name.toLowerCase()}@example.com`}).select().single();if(i){console.error(`Error adding employee ${t.first_name}: ${i.message}`);continue}let{error:r}=await s.from("visas").insert({employee_id:a.id,visa_type:t.visa.visa_type,issue_date:t.visa.issue_date,expiry_date:t.visa.expiry_date,status:t.visa.status,country_issued:"Malta",permit_number:`MT-${Math.floor(1e5*Math.random())}`});r&&console.error(`Error adding visa for ${t.first_name}: ${r.message}`)}return console.log("âœ… Seeding completed successfully."),{success:!0,message:"Seeding completed"}}catch(e){return console.error("âŒ Seeding failed:",e),{success:!1,message:e.message}}}async function u(e){let t=e.headers.get("host");if(!(t?.includes("localhost")||t?.includes("127.0.0.1")))return o.NextResponse.json({error:"Forbidden: Seeding is only allowed in local/dev environments."},{status:403});try{let e=await p();if(e.success)return o.NextResponse.json({message:"Database seeded successfully",result:e});return o.NextResponse.json({error:"Seeding failed",details:e.message},{status:500})}catch(e){return o.NextResponse.json({error:"Internal Server Error",details:e.message},{status:500})}}let d=new i.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/seed/route",pathname:"/api/seed",filename:"route",bundlePath:"app/api/seed/route"},resolvedPagePath:"/Users/glennbundy/Desktop/visatrack-malta/app/api/seed/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:c,serverHooks:_}=d,g="/api/seed/route";function v(){return(0,n.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:c})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[276,564],()=>s(8585));module.exports=a})();