(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{7375:function(e,t,r){Promise.resolve().then(r.bind(r,1073))},1073:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return k}});var s=r(7437),a=r(2265),n=r(1994),l=r(3335);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,l.m6)((0,n.W)(t))}let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{className:"relative w-full overflow-auto",children:(0,s.jsx)("table",{ref:t,className:i("w-full caption-bottom text-sm",r),...a})})});o.displayName="Table";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("thead",{ref:t,className:i("[&_tr]:border-b",r),...a})});d.displayName="TableHeader";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("tbody",{ref:t,className:i("[&_tr:last-child]:border-0",r),...a})});c.displayName="TableBody",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("tfoot",{ref:t,className:i("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...a})}).displayName="TableFooter";let x=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("tr",{ref:t,className:i("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...a})});x.displayName="TableRow";let m=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("th",{ref:t,className:i("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...a})});m.displayName="TableHead";let u=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("td",{ref:t,className:i("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...a})});u.displayName="TableCell",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("caption",{ref:t,className:i("mt-4 text-sm text-muted-foreground",r),...a})}).displayName="TableCaption";var p=r(7647),f=r(936);let h=(0,r(535).j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-error text-error-foreground hover:bg-error/80",outline:"text-foreground",success:"border-transparent bg-success text-success-foreground hover:bg-success/80",warning:"border-transparent bg-accent text-accent-foreground hover:bg-accent/80",danger:"border-transparent bg-error text-error-foreground hover:bg-error/80",info:"border-transparent bg-blue-500 text-white hover:bg-blue-500/80"}},defaultVariants:{variant:"default"}});function b(e){let{className:t,variant:r,...a}=e;return(0,s.jsx)("div",{className:i(h({variant:r}),t),...a})}var g=r(1303);function j(e){let{expiryDate:t}=e;if(!t)return(0,s.jsx)(b,{variant:"outline",className:"opacity-50 text-[10px] uppercase",children:"No Record"});let r=new Date,a=(0,f.D)(t),n=(0,g.j)(a,r);return n<0?(0,s.jsx)(b,{variant:"danger",className:"uppercase text-[10px]",children:"Expired"}):n<90?(0,s.jsxs)(b,{variant:"warning",className:"uppercase text-[10px]",children:["Expiring (",n,"d)"]}):(0,s.jsx)(b,{variant:"success",className:"uppercase text-[10px]",children:"Valid"})}function v(e){let{status:t}=e;return(0,s.jsx)(b,{variant:{active:"success",inactive:"secondary",terminated:"danger"}[t]||"outline",className:"uppercase text-[10px]",children:t})}function y(e){let{employees:t}=e;return(0,s.jsx)("div",{className:"rounded-md border",children:(0,s.jsxs)(o,{children:[(0,s.jsx)(d,{children:(0,s.jsxs)(x,{children:[(0,s.jsx)(m,{children:"Name"}),(0,s.jsx)(m,{children:"Passport"}),(0,s.jsx)(m,{children:"Nationality"}),(0,s.jsx)(m,{children:"Visa Type"}),(0,s.jsx)(m,{children:"Expiry Date"}),(0,s.jsx)(m,{children:"Visa Status"}),(0,s.jsx)(m,{children:"Employment"})]})}),(0,s.jsx)(c,{children:0===t.length?(0,s.jsx)(x,{children:(0,s.jsx)(u,{colSpan:7,className:"h-24 text-center",children:"No employees found."})}):t.map(e=>{var t;let r=null===(t=e.visas)||void 0===t?void 0:t.find(e=>"active"===e.application_status);return(0,s.jsxs)(x,{children:[(0,s.jsxs)(u,{className:"font-semibold text-secondary",children:[e.first_name," ",e.last_name]}),(0,s.jsx)(u,{className:"font-mono text-xs uppercase tracking-wider",children:e.passport_number}),(0,s.jsx)(u,{children:e.nationality}),(0,s.jsx)(u,{className:"text-xs",children:(null==r?void 0:r.visa_type)||"N/A"}),(0,s.jsx)(u,{className:"font-mono text-xs",children:(null==r?void 0:r.expiry_date)?(0,p.WU)((0,f.D)(r.expiry_date),"dd/MM/yyyy"):"N/A"}),(0,s.jsx)(u,{children:(0,s.jsx)(j,{expiryDate:null==r?void 0:r.expiry_date})}),(0,s.jsx)(u,{children:(0,s.jsx)(v,{status:e.status})})]},e.id)})})]})})}var N=r(1713);async function w(e){let t=new URLSearchParams;e&&t.append("search",e);let r=await fetch("/api/employees?".concat(t.toString()));if(!r.ok){if(401===r.status)throw Error("Unauthorized");throw Error("Failed to fetch employees")}return r.json()}var _=r(9397),T=r(3247),E=r(5863);function k(){let[e,t]=(0,a.useState)(""),{data:r,isLoading:n,isError:l}=(0,N.a)({queryKey:["employees",e],queryFn:()=>w(e)}),i=(null==r?void 0:r.filter(e=>{var t;let r=null===(t=e.visas)||void 0===t?void 0:t.find(e=>"active"===e.application_status);if(!r)return!1;let s=Math.ceil((new Date(r.expiry_date).getTime()-new Date().getTime())/864e5);return s>=0&&s<90}).length)||0,o=(null==r?void 0:r.filter(e=>{var t;let r=null===(t=e.visas)||void 0===t?void 0:t.find(e=>"active"===e.application_status);return!!r&&(new Date(r.expiry_date).getTime()-new Date().getTime())/864e5<0}).length)||0;return(0,s.jsxs)("div",{className:"flex flex-col min-h-screen",children:[(0,s.jsx)("header",{className:"border-b bg-white",children:(0,s.jsxs)("div",{className:"container mx-auto px-4 h-16 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-primary rounded flex items-center justify-center text-white font-bold text-xl",children:"V"}),(0,s.jsxs)("span",{className:"text-xl font-bold tracking-tight text-secondary",children:["VisaTrack ",(0,s.jsx)("span",{className:"text-primary",children:"Malta"})]})]}),(0,s.jsxs)("nav",{className:"flex gap-6",children:[(0,s.jsx)("span",{className:"text-sm font-medium border-b-2 border-primary py-5",children:"Employees"}),(0,s.jsx)("span",{className:"text-sm font-medium text-muted-foreground py-5 hover:text-secondary cursor-pointer",children:"Documents"}),(0,s.jsx)("span",{className:"text-sm font-medium text-muted-foreground py-5 hover:text-secondary cursor-pointer",children:"Reports"})]})]})}),(0,s.jsxs)("main",{className:"flex-1 container mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-end mb-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-secondary",children:"Workforce Overview"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-1 text-sm",children:"Manage TCN compliance and visa renewals."})]}),(0,s.jsxs)("button",{className:"bg-primary text-white px-4 py-2 rounded-md font-medium text-sm hover:bg-primary/90 transition-colors flex items-center gap-2",children:[(0,s.jsx)(_.Z,{className:"w-4 h-4"}),"Add Employee"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[(0,s.jsx)(R,{title:"Total TCNs",value:n?"...":((null==r?void 0:r.length)||0).toString()}),(0,s.jsx)(R,{title:"Expiring Soon",value:n?"...":i.toString(),color:"text-accent"}),(0,s.jsx)(R,{title:"Expired",value:n?"...":o.toString(),color:"text-error"}),(0,s.jsx)(R,{title:"Compliance Health",value:n?"...":"94%"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:[(0,s.jsxs)("div",{className:"p-4 border-b bg-slate-50/50 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,s.jsx)("h2",{className:"font-semibold text-secondary",children:"Employee Compliance List"}),(0,s.jsxs)("div",{className:"relative w-full sm:w-64",children:[(0,s.jsx)(T.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,s.jsx)("input",{type:"text",placeholder:"Search passport or name...",className:"text-xs border rounded-md pl-9 pr-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-primary/20",value:e,onChange:e=>t(e.target.value)})]})]}),n?(0,s.jsx)("div",{className:"p-12 flex justify-center items-center",children:(0,s.jsx)(E.Z,{className:"w-8 h-8 animate-spin text-primary"})}):l?(0,s.jsx)("div",{className:"p-12 text-center text-error",children:"Error loading employee data. Please try again."}):(0,s.jsx)(y,{employees:r||[]})]})]})]})}function R(e){let{title:t,value:r,color:a="text-secondary"}=e;return(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[(0,s.jsx)("h3",{className:"text-muted-foreground text-[10px] font-bold uppercase tracking-widest",children:t}),(0,s.jsx)("p",{className:i("text-3xl font-bold mt-2",a),children:r})]})}}},function(e){e.O(0,[763,862,971,117,744],function(){return e(e.s=7375)}),_N_E=e.O()}]);